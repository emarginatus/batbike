box: rocker/tidyverse
build:
  steps:
    - script:
        code: |
          current_branch = "$WERCKER_GIT_BRANCH"
          wrong_branch = "gh-pages"
          if [ $current_branch == $wrong_branch ]; then
            echo "$wrong_branch branch: nothing to do"
            exit 0
          fi
          apt-get update
          apt-get -y --no-install-recommends install libgdal-dev libproj-dev
          Rscript -e "install.packages('rmarkdown', repos = 'http://cran.rstudio.com')"
          Rscript -e "install.packages('htmlwidgets', repos = 'http://cran.rstudio.com')"
          Rscript -e "devtools::install_github('rstudio/leaflet')"
          Rscript -e "install.packages('sp', repos = 'http://cran.rstudio.com')"
          Rscript -e "install.packages('rgeos', repos = 'http://cran.rstudio.com')"
          Rscript -e "install.packages('ggvis', repos = 'http://cran.rstudio.com')"
          Rscript -e "install.packages('raster', repos = 'http://cran.rstudio.com')"
          Rscript -e "install.packages('rgdal', repos = 'http://cran.rstudio.com')"
          Rscript -e "rmarkdown::render_site(encoding = 'UTF-8')"
deploy:
  steps:
    - lukevivier/gh-pages:
      token: $GITHUB_TOKEN
      basedir: _site

---
title: "Bat Bike"
output: html_document
---

```{r load_packages, include = FALSE}
library(knitr)
opts_chunk$set(
  echo = FALSE
)
library(leaflet)
library(plotKML)
library(dplyr)
library(sp)
library(rgeos)
library(ggvis)
```

```{r map_data}
route <- readGPX("route/route.gpx")$tracks[[1]][[1]]
route_lambert <- route %>%
  select(lon, lat) %>%
  Line() %>%
  list() %>%
  Lines(ID = 1) %>%
  list() %>%
  SpatialLines(CRS("+proj=longlat +ellps=WGS84")) %>%
  spTransform(CRS("+init=epsg:31370"))
afstand <- sprintf("%.0fkm", gLength(route_lambert) / 1e3)
hoogteprofiel <- coordinates(route_lambert)[[1]][[1]] %>%
  as.data.frame() %>%
  mutate(
    L1 = lag(V1), 
    L2 = lag(V2),
    afstand = ifelse(
      is.na(L1),
      0,
      sqrt((V1 - L1) ^ 2 + (V2 - L2) ^ 2)
    ),
    cum_afstand = cumsum(afstand) / 1e3,
    hoogte = as.numeric(route$ele),
    stijging = ifelse(
      is.na(L1),
      0,
      hoogte - lag(hoogte)
    ),
    hoogtemeter = cumsum(pmax(stijging, 0))
  )
```

**Bat Bike** is een familievriendelijke fietstocht rond Halle die je in contact brengt met de wondere wereld van **vleermuizen**. De `r afstand` lange route brengt je langs een aantal stopplaatsen met extra informatie over vleermuizen. Je kan de route en de beschrijving eveneens vinden in onze folder. Deze kan je downloaden via de website als gratis afhalen bij onze partners. De route is volledig bewegwijzerd.


```{r overzicht_kaart}
leaflet(data = route) %>%
  addProviderTiles("Thunderforest.OpenCycleMap") %>%
  addPolylines(~lon, ~lat)
```


```{r hoogtemeters}
hoogteprofiel %>%
  ggvis(~cum_afstand, ~hoogte) %>%
  layer_lines() %>%
  scale_numeric("x", label = "afstand (km)") %>%
  scale_numeric("y", label = "hoogte (m)")
```

